<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AMQP消费者(AMQP Consumer)</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.b63842d3.css" as="style"><link rel="preload" href="/assets/js/app.d939b431.js" as="script"><link rel="preload" href="/assets/js/2.5b008197.js" as="script"><link rel="preload" href="/assets/js/23.55d443c8.js" as="script"><link rel="prefetch" href="/assets/js/10.08790abd.js"><link rel="prefetch" href="/assets/js/11.1b0f1374.js"><link rel="prefetch" href="/assets/js/12.17ed1079.js"><link rel="prefetch" href="/assets/js/13.8be572e6.js"><link rel="prefetch" href="/assets/js/14.986a4467.js"><link rel="prefetch" href="/assets/js/15.25e669e6.js"><link rel="prefetch" href="/assets/js/16.a6649e93.js"><link rel="prefetch" href="/assets/js/17.630e5042.js"><link rel="prefetch" href="/assets/js/18.4d6d10ff.js"><link rel="prefetch" href="/assets/js/19.a4d8ab2c.js"><link rel="prefetch" href="/assets/js/20.c4e84d4a.js"><link rel="prefetch" href="/assets/js/21.a720c707.js"><link rel="prefetch" href="/assets/js/22.daa88abd.js"><link rel="prefetch" href="/assets/js/24.d7b6197d.js"><link rel="prefetch" href="/assets/js/25.42e04929.js"><link rel="prefetch" href="/assets/js/26.c875c5e1.js"><link rel="prefetch" href="/assets/js/27.0122f1f1.js"><link rel="prefetch" href="/assets/js/28.da3795be.js"><link rel="prefetch" href="/assets/js/29.2a10bac8.js"><link rel="prefetch" href="/assets/js/3.981e1f82.js"><link rel="prefetch" href="/assets/js/4.ce77c6a4.js"><link rel="prefetch" href="/assets/js/5.a491faa2.js"><link rel="prefetch" href="/assets/js/6.b01c2485.js"><link rel="prefetch" href="/assets/js/7.d1bcd4cb.js"><link rel="prefetch" href="/assets/js/8.a1c2c018.js"><link rel="prefetch" href="/assets/js/9.ad4b599d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b63842d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="amqp消费者-amqp-consumer"><a href="#amqp消费者-amqp-consumer" class="header-anchor">#</a> AMQP消费者(AMQP Consumer)</h1> <p>高级消息队列协议（AMQP）消费者步骤通过AMQP 0-9-1兼容代理从AMQP消息生成器接收流数据。您可以配置此步骤以使用现有AMQP消息队列或创建新队列。</p> <p>您还可以设置AMQP使用者步骤，以连续从AMQP消息或代理中提取流数据，以收集有关受监视事件的消息，跟踪用户对数据流的消耗或监视警报。
父AMQP Consumer步骤运行子（子转换），该子转换根据消息批量大小或持续时间执行，使您可以近乎实时地处理连续的记录流。子转换必须以“ 从流中获取记录”步骤开始。此外，您可以选择子转换中的一个步骤，将记录流回父转换，父转换将下游的记录传递给同一父转换中包含的任何其他步骤。</p> <blockquote><p>由于AMQP Consumer步骤持续提取流数据，您可能希望在父转换或子转换中使用Abort 步骤来停止从AMQP获取特定工作流的记录。例如，您可以按定时计划运行父转换，
或者如果传感器数据超出预设范围，则中止子转换。</p></blockquote> <h3 id="前言-before-you-begin"><a href="#前言-before-you-begin" class="header-anchor">#</a> 前言(Before You Begin)</h3> <p>在使用AMQP Consumer步骤之前，请注意以下条件：</p> <ul><li>此步骤使用并要求AMQP 0-9-1消息传递协议。</li> <li>在配置此步骤之前，您必须具有AMQP 0-9-1兼容代理（例如  <a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">RabbitMQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li>在转换中，您可以单独使用AMQP Consumer步骤从任何AMQP生产者或代理中获取消息。该AMQP生产者没有必要步骤。
如果要同时使用这两个步骤（无论是在相同的转换中还是在单独的转换中），则在“消费者”步骤中指定的某些设置必须与“生产者”步骤中定义的某些设置相匹配。
下面的标签部分说明了哪些设置必须匹配。</li> <li>虽然您可以设置此步骤以使用现有AMQP消息队列，但您也可以使用此步骤创建新的AMQP消息队列。有关更多信息，请参阅创建新的AMQP消息队列。</li></ul> <h3 id="general"><a href="#general" class="header-anchor">#</a> General</h3> <p><img src="/image/PDI_TransStep_Dialog_AMQP-Consumer.png" alt=""></p> <p>为“ 步骤名称”和“ 转换”字段输入以下信息：</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>步骤名称</td> <td>指定画布上步骤的唯一名称。默认情况下，步骤名称设置为“ AMQP Consumer ”。</td></tr> <tr><td>转型</td> <td>通过执行以下任何操作指定要执行的子转换：<li>输入路径</li><li>单击“ 浏览”以选择现有子转换</li><li>单击“ 新建”以创建并保存新的子转换。有关更多详细信息，请参阅创建和保存新子转换。</li><br><strong>选定的子转换必须以“ 从流中获取记录”步骤开始。</strong> <br>如果选择与当前转换具有相同根路径的转换，则会自动插入变量$ {Internal.Entry.Current.Directory}来代替公共根路径。例如，如果当前转换的路径是：  /home/admin/transformation.ktr并且您在目录/home/admin/path/sub.ktr中选择转换，则路径将自动转换为：$ {Internal.Entry .Current.Directory} /path/sub.ktr 如果使用存储库，则必须指定转换的名称。如果您不使用存储库，则必须指定转换的XML文件名。 先前由引用指定的转换将自动转换为由Pentaho存储库中的转换名称指定。</td></tr></tbody></table> <h3 id="创建并保存新的子转换"><a href="#创建并保存新的子转换" class="header-anchor">#</a> 创建并保存新的子转换</h3> <p>如果您尚未进行子转换，则可以在设置AMQP使用者步骤时创建一个转换。单击“ 新建”按钮时，新的子转换会在新的画布选项卡中自动生成所需的<a href="">从流中获取记录</a>步骤。
您可以在子转换的“从流中获取记录”步骤中自定义所有字段和类型，以匹配在父AMQP使用者步骤的“字段”选项卡中指定的字段和类型。</p> <ol><li>在AMQP Consumer步骤中，单击New。将出现“ 另存为”对话框。</li> <li>导航到要保存新子转换的位置，然后键入文件名。</li> <li>单击“ 保存”。将显示一个通知框，通知您已在新选项卡中创建并打开子转换。如果您以后不希望看到此通知，请选中“不再显示此项”复选框。</li> <li>单击“新建转换”选项卡以查看和编辑子转换。它自动包含从流中获取记录步骤。（可选）您可以继续构建此转换并保存它。</li> <li>完成后，返回AMQP Consumer步骤。</li></ol> <h3 id="选项"><a href="#选项" class="header-anchor">#</a> 选项</h3> <p>AMQP Consumer步骤要求您在“设置”，“安全性”，“批次”，“字段”和“结果”字段选项卡中指定选项和参数。每个选项卡如下所述。</p> <h3 id="设置选项"><a href="#设置选项" class="header-anchor">#</a> 设置选项</h3> <p><img src="/image/PDI_TransStep_Tab_Setup_AMQP-Consumer.png" alt=""></p> <p>在“设置”选项卡中，指定队列名称，交换名称，交换类型以及路由键或标头的连接。您可以  <a href=".">创建新的AMQP消息队列</a>或<a href="">使用现有的AMQP消息队列</a>。</p> <h3 id="创建一个新的amqp消息队列"><a href="#创建一个新的amqp消息队列" class="header-anchor">#</a> 创建一个新的AMQP消息队列</h3> <p>AMQP使用者设置选项卡中的选项和设置使您可以在第一次在转换中运行AMQP使用者步骤时创建新的AMQP消息队列。新的AMQP消息队列将默认为以下属性：</p> <ul><li>耐用</li> <li>不自动删除</li> <li>非排他性</li></ul> <p>使用AMQP使用者创建新队列时，第一次在转换中运行AMQP使用者步骤时会初始化代理绑定。初始化绑定后，您可以在运行AMQP Consumer步骤之前启动AMQP 0-9-1消息生成器。
作为建议的最佳实践，在开始通过AMQP生成器生成或发布任何消息之前，请始终首先运行AMQP Consumer步骤。</p> <p>要在代理上创建新的AMQP消息队列，请在“设置”选项卡中定义**“ 连接”，“  队列名称”和“ Exchange名称”**选项，如下所示：</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>连接</td> <td>指定此步骤连接到的AMQP代理的URI地址，以将消息提取到PDI中。有关详细信息，请参阅：<a href="/step/https//www.rabbitmq.com/uri-spec.html">rabbit mp uri</a></td></tr> <tr><td>队列名称</td> <td>指定此步骤将从中提取消息的新AMQP消息队列的名称。<br>第一次运行转换时，将自动创建新队列。<br>新队列及其exchange属性将默认为以下属性：<li>耐用</li><li>不自动删除</li><li>非排他性</li> <br> <strong>如果指定代理上已存在的队列名称，但现有队列具有与这些不同的参数设置，或者如果指定的队列具有不同的Exchange类型（如下），则转换将中止。</strong></td></tr> <tr><td>交换名称</td> <td>指定新的交换名称或绑定队列的现有交换名称.<br> 如果交换名称尚不存在，则默认为以下属性：<li>耐用</li><li>不自动删除</li><br>将Exchange名称留空以使用DEFAULT  作为Exchange类型（如下所示）并将Exchange类型设置为DIRECT。该AMQP生产者一步都要求在其匹配的空白项设置选项卡为Exchange名称。</td></tr></tbody></table> <p>按照使用现有AMQP消息队列中的说明设置剩余的Exchange类型，路由密钥或标  头选项。</p> <h3 id="使用现有amqp消息队列"><a href="#使用现有amqp消息队列" class="header-anchor">#</a> 使用现有AMQP消息队列</h3> <p>要使用代理上已存在的AMQP消息队列，请在“设置”选项卡中定义选项，如下所示：</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>连接</td> <td>指定此步骤连接到的AMQP代理的URI地址，以将消息提取到PDI中。有关详细信息，请参阅：<a href="/step/https//www.rabbitmq.com/uri-spec.html">rabbit mp uri</a></td></tr> <tr><td>队列名称</td> <td>指定此步骤将从中提取消息的现有AMQP消息队列名称。指定的队列必须符合以下参数：<li>耐用</li><li>不自动删</li><li>非排他性</li><br><strong>如果指定尚不存在的队列名称，则此步骤将创建新队列。新队列将符合相同的参数。请参阅创建新的AMQP消息队列。</strong></td></tr> <tr><td>交换名称</td> <td>指定从中绑定队列的现有交换名称。<br> 将Exchange名称留空以使用DEFAULT  作为Exchange类型（如下所示）并将Exchange类型设置为DIRECT。该AMQP生产者一步都要求在其匹配的空白项设置选项卡为Exchange名称。</td></tr> <tr><td>交换类型</td> <td>指定此交换使用的类型模式。<br>DIRECT -根据消息路由密钥将消息路由到队列。<li>DEFAULT  - 要使用DEFAULT交换类型，请不要指定Exchange名称  （上面）并将Exchange类型设置为DIRECT。</li><br>FANOUT - 将消息路由到绑定到扇出交换的所有队列，并忽略路由密钥。<br>TOPIC -根据消息路由密钥与用于将队列绑定到交换的模式之间的匹配，将消息路由到一个或多个队列。 <br>HEADERS -使用一个或多个键/值对路由消息，这些键/值对更容易表示为消息头而不是路由键。</td></tr> <tr><td>路由密钥</td> <td>使用“路由密钥”表指定定义交换和队列之间绑定的路由密钥。有关 更多信息，  请参阅指定路由密钥</td></tr> <tr><td>Headers</td> <td>使用Headers表指定 与相应标头关联的Name和Value。有关 更多信息，请参阅指定标题。</td></tr></tbody></table> <h3 id="指定路由密钥"><a href="#指定路由密钥" class="header-anchor">#</a> 指定路由密钥</h3> <p>使用DIRECT或TOPIC  作为Exchange 类型时，请 在“路由密钥”表中指定相应的路由密钥（或多个密钥）。路由键作为字符串名称输入。</p> <p><img src="/image/PDI_TransStep_Table_Routing-Keys.png" alt=""></p> <blockquote><p>如果选择  DIRECT作为Exchange类型，并将Exchange名称留空，则无论是否在表中指定任何路由键，都会将在“ 队列名称”选项中指定的队列名称用作路由密钥。</p></blockquote> <p>为Consumer步骤指定路由键配置并运行转换后，会将路由键和Consumer配置永久绑定到指定的队列。即使您随后从此路由密钥表中删除了路由密钥，绑定也将保留在AMQP代理中。有关如何验证队列绑定的更多信息，请参阅：<a href="https://www.rabbitmq/rabbitmqctl.8.html#list_bindings" target="_blank" rel="noopener noreferrer">https://www.rabbitmq/rabbitmqctl.8.html#list_bindings<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="指定headers"><a href="#指定headers" class="header-anchor">#</a> 指定Headers</h3> <p>使用Headers作为Exchange 类型时，请 在Headers表中指定与相应标头关联的Name和Value。仅接受字符串值。</p> <p><img src="/image/PDI_TransStep_Table_Headers.png" alt=""></p> <p>指定标题有两个选项：</p> <ul><li><p><strong>匹配所有标头</strong> -要将消息传递到Consumer步骤的队列，生产者消息必须包含Consumer步骤中的所有标头键/值对。</p> <blockquote><p>请注意，生产者可能拥有比“消费者”步骤中指定的标题更多的标题。生产者标头必须与所有指定的Consumer标头匹配; 但是，
并非所有指定的Consumer标头都必须匹配所有生成器标头。</p></blockquote></li> <li><p><strong>匹配任何标头</strong> -对于要传递到Consumer步骤队列的消息，至少一个标头键/值对必须在Consumer步骤和生产者上匹配。</p></li></ul> <p>为Consumer步骤指定头配置并运行转换后，会永久地将头和Consumer配置绑定到指定的队列。即使您随后从此表中删除标头，绑定也将保留在AMQP代理中。
有关如何验证队列绑定的更多信息，请参阅：<a href="/step/https：//www.rabbitmq/rabbitmqctl.8.html#list_bindings">https：//www.rabbitmq/rabbitmqctl.8.html#list_bindings </a></p> <h3 id="安全选项卡"><a href="#安全选项卡" class="header-anchor">#</a> 安全选项卡</h3> <p><img src="/image/PDI_TransStep_Tab_Security_AMQP-Consumer.png" alt=""></p> <p>“安全”选项卡允许您为AMPQ代理定义身份验证凭据。此选项卡包括以下选项：</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>用户名</td> <td>指定访问AMQP代理所需的用户名。</td></tr> <tr><td>密码</td> <td>指定与用户名关联的密码。</td></tr> <tr><td>使用安全协议</td> <td>如果要为连接定义SSL属性，请选择此选项。<br><strong>此安全协议设置仅在PDI中使用。它不用于AEL Spark。</strong></td></tr> <tr><td>SSL属性</td> <td><strong>上下文算法</strong> - 指定您正在使用的安全协议的名称。<br><strong>密钥存储区密码</strong> - 指定希望此连接使用的密钥存储区的密码。<br><strong>密钥库路径</strong> - 指定要使用此安全连接的密钥库的文件路径位置。<br><strong>密钥库类型</strong> - 指定密钥库类型的标识名称或字符串。<br><strong>信任存储密码</strong> - 指定您希望此安全连接使用的信任存储对象的密码。<br><strong>信任存储路径</strong> - 指定希望此安全连接使用的信任存储库证书的文件路径位置。<br><strong>信任存储类型</strong> - 指定信任存储的格式。</td></tr></tbody></table> <h3 id="批量标签"><a href="#批量标签" class="header-anchor">#</a> 批量标签</h3> <p><img src="/image/PDI_TransStep_Tab_Batch_AMQP-Consumer.png" alt="批量标签"></p> <p>使用此选项卡可以创建用于摄取的窗口。您可以指定消息计数和/或特定时间量。</p> <p>AMQP Consumer步骤仅支持Auto-Ack消息。当步骤接收到auto-ack消息时，它们将从队列中删除。如果在所有消息被摄取之前转换停止，您将丢失剩余的消息。</p> <blockquote><p>虽然任一选项都会触发消耗，但第一个满意的选项将开始批量转换。
如果使用Spark作为处理引擎，则必须仅根据“ 持续时间（ms） ” 执行子转换。</p></blockquote> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>持续时间（毫秒）</td> <td>指定以毫秒为单位的时间。此值是步骤在执行转换之前收集记录所花费的时间。<br> <strong>如果使用Spark作为处理引擎，则必须设置此字段。</strong><br>如果设置为值“0”，则<strong>记录数</strong>将触发消耗。</td></tr> <tr><td>记录数量</td> <td>指定一个数字。在每个'X'个记录之后，将执行指定的转换，并将这些'X'记录传递给转换。<br>如果设置为值'0'，则持续时间触发消耗。</td></tr></tbody></table> <blockquote><p>无论是<strong>记录数</strong>或<strong>时间</strong>必须包含的值大于“0”运行转变更大。</p></blockquote> <h3 id="字段选项卡"><a href="#字段选项卡" class="header-anchor">#</a> 字段选项卡</h3> <p><img src="/image/PDI_TransStep_Tab_Fields_AMQP-Consumer.png" alt=""></p> <p>使用此选项卡可以定义记录格式的字段。</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>输入名称</td> <td>输入名称由AMQP Consumer步骤指定。默认情况下分配以下输入名称：<li>message：记录中包含的单个消息。 </li><li>队列名称：发布和接收记录的队列。</li><li>routing key：与依赖模式类型关联的路由密钥。</li><li>交换名称：接收消息的交换名称。</li></td></tr> <tr><td>输出名称</td> <td>指定替换输出名称以使用与输入名称不同的字段名称。输出名称的数据类型必须匹配类型的的输入名称。</td></tr> <tr><td>类型</td> <td>此字段标识输入名称的数据类型，不能更改。</td></tr></tbody></table> <h3 id="结果字段选项卡"><a href="#结果字段选项卡" class="header-anchor">#</a> 结果字段选项卡</h3> <p><img src="/image/PDI_TransStep_Tab_Results-Field_AMQP-Consumer.png" alt=""></p> <p>使用此选项卡从子转换中选择将记录流回父转换的步骤。此功能允许父转换中的AMQP Consumer步骤处理的记录向下游传递到同一父转换中包含的任何其他步骤。</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>返回字段：</td> <td>选择将字段流回父转换的步骤名称（来自子转换）。这些返回字段中的数据值将可用于父转换中的任何后续下游步骤。</td></tr></tbody></table> <h3 id="元数据注入支持"><a href="#元数据注入支持" class="header-anchor">#</a> 元数据注入支持</h3> <p>此步骤的所有字段都支持元数据注入。您可以将此步骤与<a href="">ETL元数据注入</a>一起使用，以在运行时将元数据传递给转换。</p> <h3 id="推荐阅读"><a href="#推荐阅读" class="header-anchor">#</a> 推荐阅读</h3> <p><a href="/step/step/amqpProducer.html">AMQP生产者</a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d939b431.js" defer></script><script src="/assets/js/2.5b008197.js" defer></script><script src="/assets/js/23.55d443c8.js" defer></script>
  </body>
</html>
